'''
Created on Aug 20, 2014

@author: rajni
'''
from math import sqrt, pow

class DBSCAN:
    def __init__(self):
        self.name = 'DBSCAN'
        self.DB = [] #Database
        self.esp = 4 #neighborhood distance for search
        self.MinPts = 2 #minimum number of points required to form a cluster
        self.cluster_inx = -1
        self.cluster = []
        
    def DBSCAN(self):
        for i in range(len(self.DB)):
            p_tmp = self.DB[i]
            if (not p_tmp.visited):
                #for each unvisited point P in dataset
                p_tmp.visited = True
                NeighborPts = self.regionQuery(p_tmp)
                if(len(NeighborPts) < self.MinPts):
                    #that point is a noise
                    p_tmp.isnoise = True
                    print p_tmp.show(), 'is a noise'
                else:
                    self.cluster.append([])
                    self.cluster_inx = self.cluster_inx + 1
                    self.expandCluster(p_tmp, NeighborPts)
    
    def expandCluster(self, P, neighbor_points):
        self.cluster[self.cluster_inx].append(P)
        iterator = iter(neighbor_points)
        while True:
            try:
                npoint_tmp = iterator.next()
                except StopIteration:
                    # StopIteration exception is raised after last element
                    break
                if (not npoint_tmp.visited):
                    #for each point P' in NeighborPts
                    npoint_tmp.visited = True
                    NeighborPts_ = self.regionQuery(npoint_tmp)
                    if (len(NeighborPts_) >= self.MinPts):
                        for j in range(len(NeighborPts_)):
                            neighbor_points.append(NeighborPts_[j])
                            if (not self.checkMembership(npoint_tmp)):
                                #if P' is not yet member of any cluster
                                self.cluster[self.cluster_inx].append(npoint_tmp)
                                else:
                                    print npoint_tmp.show(), 'is belonged to some cluster'
                                    
    def checkMembership(self, P):